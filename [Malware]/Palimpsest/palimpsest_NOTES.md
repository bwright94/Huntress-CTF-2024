# Palimpsest: Malware  

Author: Adam Rice (@adam.huntress)  

Our IT department was setting up a new workstation and started encountering some strange errors while installing software.  
The technician noticed a strange scheduled task and luckily backed it up and grabbed some log files before wiping the machine!  
Can you figure out what's going on?  
We've included the exported scheduled task and log files below.  

The archive password is infected-palimpsest.  

Attachments:  
Challenge.zip  
Application.evtx  
Security.evtx  
System.evtx  
Updater Service.xml  

## Solved by MorganX2  

use chainsaw on Linux for .evtx files  
> https://github.com/WithSecureLabs/chainsaw  

found some "Binary:" data which was actually hex  
collect all the longest lines (200+) (preferably through a script):  
> $ chainsaw search files | grep "Binary:"  

convert From Hex:  
```
000000206674797069736F6D0000020069736F6D69736F32617663316D70343100000008667265650002244A6D646174000002AF0605FFFFABDC45E9BDE6D948B7962CD820D923EEEF78323634202D20636F7265203136332072333036302035646236616136202D20482E3236342F4D5045472D342041564320636F646563202D20436F70796C65667420323030332D32303231202D20687474703A2F2F7777772E766964656F6C616E2E6F72672F783236342E68746D6C202D206F7074696F6E733A2063616261633D31207265663D33206465626C6F636B3D313A303A3020616E616C7973653D3078333A3078313133206D653D686578207375626D653D37207073793D31207073795F72643D312E30303A302E3030206D697865645F7265663D31206D655F72616E67653D3136206368726F6D615F6D653D31207472656C6C69733D31203878386463743D312063716D3D3020646561647A6F6E653D32312C313120666173745F70736B69703D31206368726F6D615F71705F6F66667365743D2D3220746872656164733D3131206C6F6F6B61686561645F746872656164733D3120736C696365645F746872656164733D30206E723D3020646563696D6174653D3120696E7465726C616365643D3020626C757261795F636F6D7061743D3020636F6E73747261696E65645F696E7472613D3020626672616D65733D3320625F707972616D69643D3220625F61646170743D3120625F626961733D30206469726563743D3120776569676874623D31206F70656E5F676F703D3020776569676874703D32206B6579696E743D323530206B6579696E745F6D696E3D3235207363656E656375743D343020696E7472615F726566726573683D302072635F6C6F6F6B61686561643D34302072633D637266206D62747265653D31206372663D32332E302071636F6D703D302E36302071706D696E3D302071706D61783D3639207170737465703D342069705F726174696F3D312E34302061713D313A312E303000800000232F658884009FDA39F09AF640E7FA7DE43CC7F24E065F1969C52A4292443358E622A1DBDDB6302C77829C16186B50F533B085521D5D490A1E801E7461AE486A1533FB2BB7E35F16F8232BF989E1FE294253C5F3F7EB5CC9711545B21546882A1BED68071E87097ECFC63DEF3BF9C5BE3A99EEBF7E6261532E9BEE6A350186C3DAFAD4BFB2CABDFD3942EB92374D4C00C942440604E2AF9698C212018F73B62A73CC6AD21ED703456A1F56A3394A99A0074FAE9C3C5D8A3FFC111B1577AFA54460A4E0B30A1D84347D0287CBCF51B88665EF250AB8EAE47870AD02085216E6101C3ED092EC55C5084F68727980E2838975E2A23CAD67E8D56E35368655F4E921CAB304DD209C45F49AB75280372FC8CC59D2D1EA38F64CC7BBC009DFD575C52B8807139362A7941EE8E74E9701AF1FFBB662D2B98F289C1103B995D350FFFF5B5ABF1759F20B8429EB393D3AD774BEAE8D0384EAD334CEC522E48546B3CE27E334F629EC57C3B689B2E3E2FAD0EBEB48CC6B9FE3D071F4D1A7B411C47D2769F1C00D51431211A2643C4AC129B240968DA156094CC32DBBAD3C0E40218A55268B3244787CC68490EA2481AA2222EA91C3D75E273F4C785295D0E343ACC767AA2630991683A5ACBD9F1545A4E8E8D6B20583CDAC4BA12355CB094CA5386DF38C235C2C36123CA6A707F89D365A053C9B5FE349934DAD4CA83E50C0C7879D31955D2E997CBD5FD0FD8C892B40363674E267535EB224DA329879FE56CCF38FF27CEB7BEDA49011F63C599ABFAFFF5FC43F47ED6B2D3E796525A20BB3A257200E45456CDFEB1E3EFB6649ECDCAA7862E1FAEC2E31DF420850E430163205E5231198F55D590E86ECBBE707B9FF6A65F9775338F8443863241C2F441607B8BE8725C11BD0316727182D5DBFAFC93A36DA4387E4ABE8EC09EF356C9C96A5BDA665AEC8C5CFBED10F924688150E8C4F91E7E5936CF74DAEF1ECDCAB478486C58495BC2D3DC3599F1B3A43C5608B
```

```
[...TRUNCATED...]
 ftypisomisomiso2avc1mp41free$Jmdat¯ÿÿ«ÜEé½æÙH·,Ø Ù#îïx264 - core 163 r3060 5db6aa6 - H.264/MPEG-4 AVC codec - Copyleft 2003-2021 - http://www.videolan.org/x264.html - options: cabac=1 ref=3 deblock=1:0:0 analyse=0x3:0x113 me=hex subme=7 psy=1 psy_rd=1.00:0.00 mixed_ref=1 me_range=16 chroma_me=1 trellis=1 8x8dct=1 cqm=0 deadzone=21,11 fast_pskip=1 chroma_qp_offset=-2 threads=11 lookahead_threads=1 sliced_threads=0 nr=0 decimate=1 interlaced=0 bluray_compat=0 constrained_intra=0 bframes=3 b_pyramid=2 b_adapt=1 b_bias=0 direct=1 weightb=1 open_gop=0 weightp=2 keyint=250 keyint_min=25 scenecut=40 intra_refresh=0 rc_lookahead=40 rc=crf mbtree=1 crf=23.0 qcomp=0.60 qpmin=0 qpmax=69 qpstep=4 ip_ratio=1.40 aq=1:1.00#/eÚ9ðö@çú}ä<ÇòN_iÅ*BD3Xæ"¡ÛÝ¶0,wkPõ3°R]I
[...TRUNCATED...]
```

'ftypisom' matches magic bytes for an mp4 file
> https://en.wikipedia.org/wiki/List_of_file_signatures
and we see 'H.264/MPEG-4 AVC codec' and 'http://www.videolan.org/x264.html'

decode all of the data and properly reconstruct the video to reveal the flag
> flag.mp4